{% extends "base.html" %}
{% block title %}MoonLight ‚Äî –ü–∞–Ω–µ–ª—å{% endblock %}
{% block page_title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}

{% block topbar_actions %}
{% if user.role in ('admin', 'owner') %}
<a href="/meetings/create" class="btn btn-primary btn-sm">Ôºã –°–æ–±—Ä–∞–Ω–∏–µ</a>
{% endif %}
{% endblock %}

{% block content %}

{% if user.role in ('admin', 'owner') %}
<!-- STATS -->
<div class="stats-grid">
    <div class="stat-card blue">
        <div class="stat-value">{{ stats.users_total or 0 }}</div>
        <div class="stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
        <div class="stat-icon">üë•</div>
    </div>
    <div class="stat-card gold">
        <div class="stat-value">{{ stats.pending_users or 0 }}</div>
        <div class="stat-label">–û–∂–∏–¥–∞—é—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è</div>
        <div class="stat-icon">‚è≥</div>
    </div>
    <div class="stat-card green">
        <div class="stat-value">{{ stats.meetings_total or 0 }}</div>
        <div class="stat-label">–°–æ–±—Ä–∞–Ω–∏–π</div>
        <div class="stat-icon">üìÖ</div>
    </div>
    <div class="stat-card red">
        <div class="stat-value">{{ stats.transfers_pending or 0 }}</div>
        <div class="stat-label">–ü–µ—Ä–µ–≤–æ–¥–æ–≤ –Ω–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏</div>
        <div class="stat-icon">üîÑ</div>
    </div>
</div>

<div class="grid-2">
    <!-- Recent Meetings -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—Ä–∞–Ω–∏—è</div>
            <a href="/meetings" class="btn btn-ghost btn-sm">–í—Å–µ ‚Üí</a>
        </div>
        {% if recent_meetings %}
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                {% for m in recent_meetings %}
                <tr>
                    <td><a href="/meetings/{{ m.id }}" style="color:var(--accent);text-decoration:none;font-weight:600">{{ m.title }}</a></td>
                    <td style="color:var(--text3);font-size:12px">{{ m.scheduled_at[:16].replace('T',' ') }}</td>
                    <td><span class="badge badge-{{ m.status }}">{{ m.status }}</span></td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty"><div class="empty-icon">üì≠</div><div class="empty-text">–ù–µ—Ç —Å–æ–±—Ä–∞–Ω–∏–π</div></div>
        {% endif %}
    </div>

    <!-- Recent Transfers -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">üîÑ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥—ã</div>
            <a href="/transfers" class="btn btn-ghost btn-sm">–í—Å–µ ‚Üí</a>
        </div>
        {% if recent_transfers %}
        <div class="table-wrap">
            <table>
                <thead>
                    <tr>
                        <th>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</th>
                        <th>–°–æ–∑–¥–∞–ª</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                    </tr>
                </thead>
                <tbody>
                {% for t in recent_transfers %}
                <tr>
                    <td style="font-weight:600;color:var(--text)">{{ t.organization }}</td>
                    <td style="color:var(--text2)">{{ t.creator_name or '‚Äî' }}</td>
                    <td><span class="badge badge-{{ t.status }}">{{ t.status }}</span></td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty"><div class="empty-icon">üì≠</div><div class="empty-text">–ù–µ—Ç –ø–µ—Ä–µ–≤–æ–¥–æ–≤</div></div>
        {% endif %}
    </div>
</div>

{% else %}
<!-- NEWBIE DASHBOARD -->
<div class="card" style="max-width:600px;margin:0 auto;text-align:center;padding:48px">
    <div style="font-size:56px;margin-bottom:16px">‚òΩ</div>
    <div style="font-family:'Rajdhani',sans-serif;font-size:26px;font-weight:700;margin-bottom:8px">
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.username }}!
    </div>
    <div style="color:var(--text2);font-size:14px;margin-bottom:32px;line-height:1.6">
        –í—ã –≤–æ—à–ª–∏ –≤ —Å–∏—Å—Ç–µ–º—É MoonLight.<br>
        –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ–±—Ä–∞–Ω–∏—è –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å —Å–≤–æ—ë —É—á–∞—Å—Ç–∏–µ.
    </div>
    <a href="/meetings" class="btn btn-primary" style="font-size:15px;padding:12px 28px">
        üìÖ –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–æ–±—Ä–∞–Ω–∏—è–º
    </a>
</div>

{% if recent_meetings %}
<div class="card" style="margin-top:20px">
    <div class="card-header">
        <div class="card-title">üìÖ –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ —Å–æ–±—Ä–∞–Ω–∏—è</div>
    </div>
    <div class="table-wrap">
        <table>
            <thead>
                <tr><th>–ù–∞–∑–≤–∞–Ω–∏–µ</th><th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th><th></th></tr>
            </thead>
            <tbody>
            {% for m in recent_meetings %}
            <tr>
                <td style="font-weight:600;color:var(--text)">{{ m.title }}</td>
                <td style="color:var(--text2);font-size:13px">{{ m.scheduled_at[:16].replace('T',' ') }}</td>
                <td><a href="/meetings/{{ m.id }}" class="btn btn-primary btn-sm">–û—Ç–∫—Ä—ã—Ç—å</a></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endif %}

{% endblock %}
